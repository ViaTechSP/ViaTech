<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/login.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
</head>
<body>
    <!-- MOBILE -->
   

    <div class="header">
        <div class="navbar">

        <a href="index.html#div_home">

         <div class="containerLogo">
                <img src="../assets/imgs/icon.svg" class="logo">ViaTech
            </div>
        </a>

         <div class="containerNavegacao">
             <ul>
                 <li>
                     <a href="index.html#div_home">Início</a>
                 </li>
                 <li>
                     <a href="index.html#div_sobre_nos">Sobre Nós</a>
                 </li>
                 <li>
                     <a href="index.html#div_saiba_mais">Saiba Mais</a>
                 </li>
                 <li>
                     <a href="index.html#div_servico">Serviços</a>
                 </li>
             </ul>
         </div>

         <div class="containerBotaoHeader">
             <button onclick="Login()" class="btn-login">Login</button>
             <button onclick="Cadastrar()" class="btn-cadastrar">Cadastrar</button>
         </div>
         <div id="abrirMenu">
            <i class="material-icons" onclick="clicarMenu()"><img src="https://cdn-icons-png.flaticon.com/128/1214/1214477.png" alt="" style="width: 80%;"></i>
        </div>
        </div>
     </div> <!-- FINAL DO HEADER -->

    <div id="div_home" class="home">
        <menu id="itens" class="menu">
            <ul>
                <li class="navbarMenu"><a href="index.html">Início</a></li>
                <li class="navbarMenu"><a href="index.html">Sobre nós</a></li>
                <li class="navbarMenu"><a href="index.html">Saiba Mais</a></li>
                <li class="navbarMenu"><a href="index.html">Serviços</a></li>
                <li class="navbarMenu"><a href="login.html">Login</a></li>
                <li class="navbarMenu"><a href="cadastro.html">Cadastrar</a></li>
            </ul>
        </menu>
        <img src="../assets/imgs/imagemEsqueceuSenha.jpg" alt="metro em movimento" class="imagemHome">
        
            <div id="div_email" class="container">
                                   
                    <h1>Login</h1>
                    <p>Email</p>
                    <input id="input_email" type="text">
                    <p>Senha</p>
                   <input id="input_senha" type="password">

                    <p id="frase_validacao" style="display: none;">Email inválido!</p>
                    <button onclick="login()" class="botaoAvancar">Login</button>

                    <p id="frase-senha">Esquceu a senha? <u>

                        <a href="esqueceuSenha.html">Clique aqui</a></p>
                    </u>          
            </div>          
    </div> <!-- FINAL DA IMAGEM DE FUNDO-->


</body>
</html>


<script>
    function acessar() {

     var email = input_email.value;
     var senha = input_senha.value;
         
     if (email.indexOf('@') >= 0 && (email.indexOf('.com') >= 0 || email.indexOf('.br') >= 0) && senha.length >= 8 ) {
     
      /*Enviando para o servidor*/
      fetch("/usuarios/autenticar",{
        method: "POST",
        headers: {
        "Content-Type": "application/json"
       },
       body: JSON.stringify({
        emailServer: email,
        senhaServer: senha
       })
     })
     
     
     .then(function (resposta) {
        console.log("ESTOU NO THEN DO entrar()!")
     
       if (resposta.status == 200) {
        resposta.json().then(json => {
          
          /*Como os dados vem em json dentro de um vetor, estou pegando a primeira posição*/
          console.log(JSON.stringify(json));
          sessionStorage.ID_EMPRESA = json[0].idEmpresa;
          sessionStorage.NOME_EMPRESA = json[0].nomeFantasia;
          sessionStorage.EMAIL_EMPRESA = json[0].email;
          sessionStorage.CNPJ_EMPRESA = json[0].CNPJ;
          sessionStorage.TELEFONE_EMPRESA = json[0].telefone;
          sessionStorage.SENHA_EMPRESA = json[0].senha;
          window.location.href = "cadastroFuncionario.html";
     
         });
     
       }
     
       else {
        console.log("Houve um erro ao tentar realizar o login!");
        div_senha_errado.innerHTML = `Senha ou email invalidos!`
     
        resposta.text().then(texto => {
          console.error(texto);
         });
       }
     }).catch(function (erro) {
       console.log(erro);
     })
     }
     
     else {
     div_senha_errado.innerHTML = `Email ou senha incorreta!`;
     }      
     } 





    function login(){
        
        var exibir_frase = frase_validacao;
        var validar_email = input_email.value;
        var divEmail = div_email;

        if(validar_email.indexOf("@") >= 1 && validar_email.indexOf(".") >= 1){
        var divRedefinir = document.getElementById("div_redefinir");

        acessar();
        
    } else{
            exibir_frase.style.display = "block";
            exibir_frase.style.color = "#ff5353";
            exibir_frase.style.fontWeight = "bold";
        
        }
    }

    function Login(){
        window.location = "login.html"
    }
        function Cadastrar(){
            window.location ="cadastro.html"
    }
</script>